<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Characters - World Builder</title>

<style>
:root{
    --bg-main:#0f1117;
    --bg-card:#1a1d26;
    --bg-accent:#232734;
    --text-main:#e6e9ef;
    --text-muted:#9aa3b2;
    --accent:#5aa2ff;
    --radius:14px;
}

*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:system-ui, sans-serif;
}

body{
    background:var(--bg-main);
    color:var(--text-main);
    padding-bottom:80px;
}

/* HEADER */
header{
    padding:18px;
    background:var(--bg-card);
    position:sticky;
    top:0;
    border-bottom:1px solid #2a2f3d;
}

#searchInput{
    margin-top:12px;
    width:100%;
    padding:12px;
    border-radius:var(--radius);
    border:none;
    background:var(--bg-accent);
    color:white;
    font-size:14px;
}

#searchInput::placeholder{
    color:var(--text-muted);
}

/* FOLDER BAR */
.folder-bar{
    display:flex;
    gap:10px;
    overflow-x:auto;
    padding:14px;
}

.folder{
    background:var(--bg-accent);
    padding:10px 16px;
    border-radius:999px;
    font-size:14px;
}

/* CARDS */
.section{
    padding:16px;
}

.card{
    background:var(--bg-card);
    padding:16px;
    border-radius:var(--radius);
    margin-bottom:14px;
    border:1px solid #2a2f3d;
    transition:transform .15s ease, border-color .15s ease;
}

.card-title{
    font-weight:600;
    font-size:17px;
}

.card-tags{
    font-size:12px;
    color:var(--text-muted);
    margin-top:6px;
}

.card:hover{
    transform:translateY(-2px);
    border-color:var(--accent);
}


/* BOTTOM NAV */
.bottom-nav{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    height:65px;
    background:var(--bg-card);
    border-top:1px solid #2a2f3d;
    display:flex;
    justify-content:space-around;
    align-items:center;
}

.nav-btn{
    font-size:12px;
    color:var(--text-muted);
    text-decoration:none;
}

.nav-btn.active{
    color:var(--accent);
}


/* FLOATING ACTION BUTTON */
.fab{
    position:fixed;
    bottom:90px;
    right:20px;

    width:60px;
    height:60px;
    border-radius:50%;

    background:var(--accent);
    color:white;

    font-size:32px;
    display:flex;
    align-items:center;
    justify-content:center;

    text-decoration:none;

    box-shadow:0 6px 20px rgba(0,0,0,0.4);
    transition:transform 0.3s ease;
}

/* ROTATE EFFECT WHEN PRESSED */
.fab:active{
    transform:rotate(90deg) scale(0.95);
}

/* AVATAR CSS */
.avatar{
    width:70px;
    height:70px;
    border-radius:50%;
    object-fit:cover;
    background:var(--bg-accent);
    margin-bottom:10px;
    display:block;
}

/* TEXT WRAPPER */

.card-content{
    display:flex;
    gap:16px;
    align-items:flex-start;
}

.card-text{
    flex:1;
}

.card-desc{
    color:var(--text-muted);
    margin-top:4px;
    line-height:1.4;
    font-size:14px;
}

/* FOLDER */

.folder{
    background:var(--bg-accent);
    padding:10px 16px;
    border-radius:999px;
    font-size:14px;
    cursor:pointer;
    white-space:nowrap;
    transition:.15s;
}

.folder.active{
    background:var(--accent);
    color:white;
}
#addFolderBtn:hover{
    color:white;
    background:var(--accent);
}

/* ========== BUTTON STYLING ============= */

.editBtn, .viewBtn{
    border:none;
    background:var(--bg-accent);
    color:var(--text-muted);
    border-radius:8px;
    width:36px;
    height:36px;
    cursor:pointer;
    font-size:16px;
    transition:.15s;
}

.editBtn:hover{
    background:var(--accent);
    color:white;
}

.viewBtn:hover{
    background:var(--accent);
    color:white;
}


/*=================ID CARD=======================*/

.card-id-row{
    display:flex;
    align-items:center;
    gap:8px;
    margin-top:4px;
    font-size:11px;
    color:var(--text-muted);
    flex-wrap:wrap;
}

.copy-id-btn{
    border:none;
    background:var(--bg-accent);
    color:var(--text-muted);
    border-radius:6px;
    padding:2px 6px;
    font-size:11px;
    cursor:pointer;
    transition:.15s;
}

.copy-id-btn:hover{
    background:var(--accent);
    color:white;
}


</style>
</head>

<body>
   

<header>
    
<!-- MAIN BODY -->
    
    <h1>Characters</h1>

<input id="searchInput" type="text" placeholder="Search Characters or #Tags">


</header>

<div class="folder-bar" id="folderBar"></div>

<div style="padding:0 14px 10px 14px;">
    <button id="addFolderBtn" style="
        width:100%;
        padding:10px;
        border-radius:999px;
        border:none;
        background:var(--bg-accent);
        color:var(--text-muted);
        cursor:pointer;
    ">
        + Add Folder
    </button>
</div>


<section class="section">



<!-- ===== CHARACTER LIST ===== -->
<section class="section">
    <h2>Character List</h2>

    <div id="characterList"></div>

</section>


<!-- ===== BOTTOM NAV ===== -->
<nav class="bottom-nav">
    <a href="index.html" class="nav-btn active">Home</a>
    <a href="events.html" class="nav-btn">Events</a>
    <a href="character.html" class="nav-btn">Characters</a>
    <a href="world.html" class="nav-btn">World</a>
    <a href="#" class="nav-btn">Folders</a>
</nav>




<!-- FLOATING ADD CHARACTER BUTTON -->
<a href="add-character.html" class="fab" id="fabBtn">
    +
</a>

<!-- JAVA SCRIPT -->

<script>

/* =========================
   GLOBAL STATE
========================= */
const list = document.getElementById("characterList");
const searchInput = document.getElementById("searchInput");
const folderBar = document.getElementById("folderBar");
const addFolderBtn = document.getElementById("addFolderBtn");

let characters = [];
let savedFolders = JSON.parse(localStorage.getItem("folders")) || [];
let activeFolder = "All";


/* =========================
   LOAD CHARACTERS (SAFE)
========================= */
function loadCharacters(){
    characters = JSON.parse(localStorage.getItem("characters")) || [];

    // Auto-assign IDs if missing
    let changed = false;

    characters = characters.map(c => {
        if(!c.id){
            changed = true;
            return { ...c, id: crypto.randomUUID() };
        }
        return c;
    });

    if(changed){
        localStorage.setItem("characters", JSON.stringify(characters));
    }
}



/* =========================
   CARD CREATOR
========================= */
function createCard(char){

    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
        <div class="card-content">

            ${char.image 
                ? `<img src="${char.image}" class="avatar">`
                : `<div class="avatar"></div>`
            }

            <div class="card-text">
                <div class="card-title">${char.name || "Unnamed Character"}</div>

                <div class="card-id-row">
                    <span>${char.id}</span>
                    <button class="copy-id-btn" data-id="${char.id}">Copy</button>
                </div>

                <div class="card-desc">${char.desc || ""}</div>
                <div class="card-tags">${char.tags || ""}</div>
            </div>

            <div style="display:flex; flex-direction:column; gap:8px;">
                <button class="editBtn" title="Edit">✏</button>
                <button class="viewBtn" title="View">▶</button>
            </div>

        </div>
    `;

    card.querySelector(".copy-id-btn").addEventListener("click", async (e)=>{
        e.stopPropagation();
        const id = e.target.dataset.id;

        try{
            await navigator.clipboard.writeText(id);
            e.target.textContent = "✔";
            setTimeout(()=> e.target.textContent = "Copy", 1000);
        }catch{
            alert("Failed to copy ID.");
        }
    });

    card.querySelector(".editBtn").addEventListener("click", (e)=>{
        e.stopPropagation();
        localStorage.setItem("editingCharacterId", char.id);
        window.location.href = "character-manager.html";
    });

    card.querySelector(".viewBtn").addEventListener("click", (e)=>{
        e.stopPropagation();
        localStorage.setItem("viewingCharacterId", char.id);
        window.location.href = "character-viewer.html";
    });

    return card;
}

    
/* =========================
   RENDER LIST
========================= */
function renderList(array){

    list.innerHTML = "";

    if(array.length === 0){
        list.innerHTML = "<p style='color:var(--text-muted)'>No characters found.</p>";
        return;
    }

    array.forEach(char => {
        list.appendChild(createCard(char));
    });
}



/* =========================
   FOLDER SYSTEM
========================= */
function getFolders(){

    const folders = new Set(["All"]);

    savedFolders.forEach(f => folders.add(f));

    characters.forEach(c=>{
        if(c.folder && c.folder.trim() !== ""){
            folders.add(c.folder);
        }
    });

    return [...folders];
}

function buildFolderBar(){

    folderBar.innerHTML = "";

    const folders = getFolders();

    folders.forEach(folderName => {

        const btn = document.createElement("div");
        btn.className = "folder";
        btn.textContent = folderName;

        if(folderName === activeFolder){
            btn.classList.add("active");
        }

        btn.addEventListener("click", ()=>{
            activeFolder = folderName;
            buildFolderBar();
            applyFilters();
        });

        folderBar.appendChild(btn);
    });
}


/* =========================
   FILTER PIPELINE
========================= */
function applyFilters(){

    loadCharacters();

    let filtered = [...characters];

    /* Folder filter */
    if(activeFolder !== "All"){
        filtered = filtered.filter(c =>
            (c.folder || "").toLowerCase() === activeFolder.toLowerCase()
        );
    }

    /* Search filter */
    const query = searchInput.value.toLowerCase().trim();

    if(query){
        filtered = filtered.filter(char => {

            const name = (char.name || "").toLowerCase();
            const tags = (char.tags || "").toLowerCase();

            if(query.startsWith("#")){
                return tags.includes(query);
            }

            return name.includes(query) || tags.includes(query);
        });
    }

    renderList(filtered);
}


/* =========================
   ADD FOLDER
========================= */
addFolderBtn.addEventListener("click", ()=>{

    const name = prompt("Folder name:");

    if(!name) return;

    const trimmed = name.trim();

    if(trimmed === "") return;

    if(savedFolders.includes(trimmed)){
        alert("Folder already exists.");
        return;
    }

    savedFolders.push(trimmed);
    localStorage.setItem("folders", JSON.stringify(savedFolders));

    buildFolderBar();
});


/* =========================
   EVENTS
========================= */
searchInput.addEventListener("input", applyFilters);


/* Refresh if returning from manager page */
window.addEventListener("focus", () => {
    init();
});


/* =========================
   INIT
========================= */
function init(){
    loadCharacters();
    buildFolderBar();
    applyFilters();
}

init();


</script>
</body>
</html>
